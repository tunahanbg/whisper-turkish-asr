# ASR System Configuration
# ModÃ¼ler ve deÄŸiÅŸtirilebilir yapÄ±landÄ±rma dosyasÄ±

# Model KonfigÃ¼rasyonu
model:
    # Model seÃ§imi: "whisper" veya "faster-whisper"
    # faster-whisper: 3-4x daha hÄ±zlÄ±, daha az memory, int8 quantization
    name: "faster-whisper" # "whisper" | "faster-whisper" | "mlx_whisper"

    variant: "base" # tiny, base, small, medium, large (kÃ¼Ã§Ã¼k = hÄ±zlÄ±)
    device: "cpu" # cpu, cuda (MPS desteklenmiyor)
    compute_type: "int8" # int8 (en hÄ±zlÄ±), int16, float16, float32

    # Model paths
    download_root: "./checkpoints" # Pre-trained models iÃ§in
    model_path: null # Custom/fine-tuned model iÃ§in (Ã¶rn: "./my_model" veya HF model ID)

    # Faster-Whisper Ã¶zel ayarlar
    num_workers: 1 # Paralel iÅŸlem sayÄ±sÄ±
    cpu_threads: 4 # CPU thread sayÄ±sÄ±

    # Alternative models (gelecek iÃ§in)
    alternatives:
        whisper:
            enabled: true
            notes: "Standard Whisper (ëŠë¦¼ ama %95 accuracy)"
        faster_whisper:
            enabled: true
            notes: "CTranslate2 optimized (3-4x hÄ±zlÄ±)"
        mlx_whisper:
            enabled: false
            notes: "Apple Silicon native (en hÄ±zlÄ±, sadece Mac)"

# Dil AyarlarÄ±
language:
    default: null # null = otomatik algÄ±lama
    supported: ["tr", "en"] # TÃ¼rkÃ§e ve Ä°ngilizce

# Ses Ä°ÅŸleme Parametreleri
audio:
    sample_rate: 16000
    channels: 1 # mono
    format: "wav"
    chunk_duration: 30 # saniye (Whisper iÃ§in optimal)

    # Ã–n Ä°ÅŸleme AyarlarÄ±
    # NOT: Preprocessing TAMAMEN DEVRE DIÅI Ã§Ã¼nkÃ¼ Whisper kendi preprocessing'ini yapÄ±yor
    # DÄ±ÅŸ preprocessing audio'yu bozuyor ve yanlÄ±ÅŸ transkripsiyon Ã¼retiyor
    preprocessing:
        enabled: false
        normalize: false
        trim_silence: false
        trim_threshold_db: 20
        denoise: false
        noise_reduction_strength: 0.8

# Voice Activity Detection (VAD)
vad:
    enabled: true
    model: "silero"
    threshold: 0.5 # 0-1 arasÄ±, yÃ¼ksek = daha hassas
    min_speech_duration_ms: 250
    max_speech_duration_s: 600 # 10 dakika
    min_silence_duration_ms: 10000 # 10 saniye
    window_size_samples: 512
    speech_pad_ms: 30 # KonuÅŸma Ã¶ncesi/sonrasÄ± padding

# Mikrofon KaydÄ±
recording:
    device: null # null = varsayÄ±lan mikrofon
    auto_stop_silence: true # VAD ile otomatik durdurma
    max_recording_duration: 600 # 10 dakika
    buffer_size: 1024

# Transkripsiyon AyarlarÄ±
transcription:
    task: "transcribe" # transcribe veya translate
    temperature: 0.0 # 0 = deterministik (MPS ile 0.2 NaN hatasÄ± veriyor, CPU'da 0.0 gÃ¼venli)
    beam_size: 5
    best_of: 5
    patience: 1.0
    length_penalty: 1.0
    compression_ratio_threshold: 2.4
    # log_prob_threshold: -1.0  # Deprecated in newer Whisper versions
    no_speech_threshold: 0.6
    condition_on_previous_text: false # TRUE olunca pattern tekrarlarÄ±nda halÃ¼sinasyon yapÄ±yor!
    initial_prompt: null # TÃ¼rkÃ§e iÃ§in: "Merhaba, bugÃ¼n hava Ã§ok gÃ¼zel."
    word_timestamps: false # MPS (Apple Silicon) float64 desteklemiyor, DTW ile uyumsuz

# Fine-tuning AyarlarÄ± (Gelecek iÃ§in)
finetuning:
    enabled: false
    checkpoint_path: null
    lora:
        r: 32
        alpha: 64
        dropout: 0.05
        target_modules: ["q_proj", "v_proj"]

# Dataset AyarlarÄ±
dataset:
    common_voice:
        language: "tr"
        version: "17.0"
        split_ratio:
            train: 0.8
            validation: 0.1
            test: 0.1

# Performans ve Optimizasyon
performance:
    batch_size: 16
    num_workers: 4
    cache_enabled: true
    cache_dir: "./data/cache"

# Logging
logging:
    level: "INFO" # DEBUG, INFO, WARNING, ERROR
    file: "./logs/asr_system.log"
    console: true
    format: "{time:YYYY-MM-DD HH:mm:ss} | {level: <8} | {name}:{function}:{line} - {message}"
    rotation: "100 MB"
    retention: "1 week"

# UI AyarlarÄ±
ui:
    title: "ğŸ¤ KonuÅŸma TanÄ±ma Sistemi"
    theme: "dark" # light, dark
    show_advanced_options: false
    max_upload_size_mb: 200
    supported_formats: ["wav", "mp3", "m4a", "ogg", "flac"]

# Paths
paths:
    data_dir: "./data"
    models_dir: "./checkpoints"
    logs_dir: "./logs"
    cache_dir: "./data/cache"
    output_dir: "./output"

# Test ve DeÄŸerlendirme (Faz 7)
evaluation:
    # Test veri seti
    test_set_path: "./tests/data/test_set"
    results_dir: "./tests/data/results"

    # KarÅŸÄ±laÅŸtÄ±rÄ±lacak modeller
    model_variants: ["tiny", "base", "small", "medium", "large-v3-w4a16"]
    implementations: ["whisper", "faster-whisper"]

    # Custom models (quantized, fine-tuned)
    custom_models:
        large_v3_quantized:
            name: "whisper" # Use transformers-based WhisperASR
            variant: "large-v3-w4a16"
            model_path: "./checkpoints/hf_models/whisper-large-v3-w4a16"
            device: "mps" # Apple Silicon GPU kullan (CPU yerine 3-5x hÄ±zlÄ±!)
            compute_type: "float16"
            description: "INT4 quantized large-v3 model (nm-testing/whisper-large-v3.w4a16)"

    # Preprocessing karÅŸÄ±laÅŸtÄ±rmasÄ±
    preprocessing_configs:
        - name: "no_preprocessing"
          enabled: false
        - name: "basic"
          enabled: true
          normalize: true
          trim_silence: true
          denoise: false
        - name: "full"
          enabled: true
          normalize: true
          trim_silence: true
          denoise: true
          noise_reduction_strength: 0.8

    # Hesaplanacak metrikler
    metrics:
        - wer
        - cer
        - rtf
        - latency
        - cpu_usage
        - memory_usage

    # Test seti hazÄ±rlama
    dataset_preparation:
        source_dir: "./data/raw/TR" # FLAC + TXT dosyalarÄ±
        sample_count: 300 # Rastgele seÃ§ilecek Ã¶rnek sayÄ±sÄ±
        seed: 42 # Reproducibility iÃ§in random seed
